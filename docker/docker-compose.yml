services:
  postgres:
    image: postgres:15-alpine
    container_name: digitalwallet-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: DigitalWallet
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped
    networks:
      - digitalwallet-network

  api:
    image: your-registry/digitalwallet-api:latest
    container_name: digitalwallet-api
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:80
      - ConnectionStrings__DefaultConnection=Host=postgres;Port=5432;Database=DigitalWallet;Username=${POSTGRES_USER};Password=${POSTGRES_PASSWORD}
      - Auth0__Domain=${AUTH0_DOMAIN}
      - Auth0__ClientId=${AUTH0_CLIENT_ID}
      - Auth0__Audience=${AUTH0_AUDIENCE}
      - SmtpSettings__SmtpHost=${SMTP_HOST}
      - SmtpSettings__SmtpPort=${SMTP_PORT}
      - SmtpSettings__SmtpUser=${SMTP_USER}
      - SmtpSettings__SmtpPassword=${SMTP_PASSWORD}
      - SmtpSettings__UseSsl=true
      - SmtpSettings__FromEmail=${SMTP_FROM_EMAIL}
      - SmtpSettings__FromName=Digital Wallet
      - FileStorage__BasePath=/app/uploads
      - WebhookApiKey=${WEBHOOK_API_KEY}
    ports:
      - "80:80"
    depends_on:
      - postgres
    volumes:
      - uploads_data:/app/uploads
    restart: unless-stopped
    networks:
      - digitalwallet-network

volumes:
  postgres_data:
  uploads_data:

networks:
  digitalwallet-network:
    driver: bridge